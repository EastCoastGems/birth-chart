<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cosmic Birth Chart | East Coast Gems</title>
  <link rel="icon" href="https://i.ibb.co/ZRrgQ9db/IMG-2055.png" />
  <style>
    body {
      font-family: 'Segoe UI', Roboto, Arial, sans-serif;
      background: linear-gradient(135deg, #2a0845 0%, #b23cf0 100%);
      margin: 0;
      min-height: 100vh;
      color: #e0e0e0;
    }
    .container {
      max-width: 700px;
      margin: 3rem auto;
      background: rgba(34,8,69,0.7);
      border-radius: 18px;
      box-shadow: 0 4px 24px rgba(178,60,240,0.12);
      padding: 2.5rem 2rem;
      text-align: center;
      position: relative;
      z-index: 1;
    }
    .cosmic-floating-stars {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 0;
    }
    .star-emoji {
      position: fixed;
      animation: floatStar 4s infinite alternate;
      z-index: -1;
    }
    .banner__heading {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      background: linear-gradient(270deg, #b23cf0, #6fffe9, #ffb6ff, #ffe66f, #b23cf0);
      background-size: 800% 800%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradientMove 6s ease-in-out infinite;
    }
    .banner__subtitle {
      font-size: 1.3rem;
      color: #ffe66f;
      font-weight: 600;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 8px #b23cf0;
    }
    .banner__text {
      font-size: 1.1rem;
      color: #e0e0e0;
      margin-bottom: 1rem;
      max-width: 600px;
      font-style: italic;
      margin-left: auto;
      margin-right: auto;
    }
    .banner__floating {
      width: 100%;
      text-align: center;
      margin-top: 2rem;
      font-size: 1.2rem;
      color: #ffd700;
      animation: floatText 3s infinite alternate;
      text-shadow: 0 0 12px #ffd700, 0 0 24px #b23cf0;
    }
    @keyframes floatText {
      0% { transform: translateY(0); }
      100% { transform: translateY(-12px); }
    }
    @keyframes floatStar {
      0% { transform: translateY(0); }
      100% { transform: translateY(-18px); }
    }
    .radio-group {
      display: flex;
      gap: 1.5rem;
      margin: 1rem 0;
      align-items: center;
      justify-content: center;
    }
    .radio-group label {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin: 0;
      white-space: nowrap;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: 600;
      color: #ffe66f;
      text-align: left;
    }
    input, select, button {
      width: 100%;
      padding: 0.75rem;
      margin-top: 0.5rem;
      font-size: 1rem;
      border: 2px solid #b23cf0;
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      box-sizing: border-box;
      transition: all 0.3s ease;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
    }
    button {
      margin-top: 1.5rem;
      background: linear-gradient(90deg,#b23cf0 0%,#ffd700 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s ease;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(178, 60, 240, 0.4);
    }
    .chart-container {
      margin: 2rem auto;
      display: none;
      justify-content: center;
      align-items: center;
    }
    #birth-chart {
      background: transparent;
      border-radius: 50%;
      box-shadow: 0 4px 12px rgba(178, 60, 240, 0.15);
    }
    #results {
      margin-top: 2rem;
      text-align: left;
    }
    .success {
      background: #e0ffe0;
      color: #388e3c;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      border: 1px solid #b2fab4;
    }
    .error {
      background: #ffe0e0;
      color: #d32f2f;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      border: 1px solid #fab2b2;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="cosmic-floating-stars">
      <span class="star-emoji" style="left:10%;top:20%;font-size:2rem;animation:floatStar 4s infinite alternate;">‚ú®</span>
      <span class="star-emoji" style="left:80%;top:30%;font-size:2.5rem;animation:floatStar 5s infinite alternate-reverse;">üåü</span>
      <span class="star-emoji" style="left:50%;top:10%;font-size:1.8rem;animation:floatStar 3.5s infinite alternate;">‚≠ê</span>
      <span class="star-emoji" style="left:25%;top:60%;font-size:2.2rem;animation:floatStar 4.5s infinite alternate-reverse;">‚ú®</span>
      <span class="star-emoji" style="left:70%;top:75%;font-size:2rem;animation:floatStar 3s infinite alternate;">üåü</span>
    </div>
    <img src="https://i.ibb.co/ZRrgQ9db/IMG-2055.png" alt="East Coast Gems Logo" style="max-width:120px;margin-bottom:1rem;border-radius:16px;box-shadow:0 0 16px #b23cf0;">
    <h2 class="banner__heading">Discover Your Astrology Blueprint</h2>
    <div class="form-section">
      <form id="birth-form" autocomplete="off">
        <label>Date of Birth:
          <input type="date" id="birthdate" required />
        </label>
        <label>Time of Birth:
          <input type="time" id="birthtime" required />
        </label>
        <label>Birthplace (City, State or Country):
          <input type="text" id="location" placeholder="e.g. New York, NY or London, UK" required />
        </label>
        <div class="radio-group">
          <label><input type="radio" name="readingType" value="bigThree" checked> Big Three</label>
          <label><input type="radio" name="readingType" value="fullChart"> Complete Chart</label>
        </div>
        <button type="submit">Generate Your Chart</button>
      </form>
      <div id="chart-description"></div>
    </div>
    <div class="chart-container" style="display:none;">
      <canvas id="birth-chart" width="400" height="400"></canvas>
    </div>
    <div class="sky-container" style="display:none;">
      <canvas id="skyCanvas" width="400" height="200"></canvas>
    </div>
    <button id="downloadBtn" style="display:none;margin-top:1rem;">Download Sky Map</button>
    <div id="results"></div>
    <a href="https://eastcoastgemsbycara.myshopify.com/" target="_blank" id="shopBtn" style="display:block;margin:2rem auto 0 auto;padding:1rem 2rem;background:#b23cf0;color:#ffe66f;font-weight:700;border-radius:12px;text-decoration:none;box-shadow:0 2px 12px #b23cf0;max-width:300px;">‚ú® Visit My Shop ‚ú®</a>
  </div>
  <script>
// Zodiac signs array (moved to top to avoid ReferenceError)
const zodiacSigns = [
  { name: "Aries", symbol: "‚ôà", start: 0 },
  { name: "Taurus", symbol: "‚ôâ", start: 30 },
  { name: "Gemini", symbol: "‚ôä", start: 60 },
  { name: "Cancer", symbol: "‚ôã", start: 90 },
  { name: "Leo", symbol: "‚ôå", start: 120 },
  { name: "Virgo", symbol: "‚ôç", start: 150 },
  { name: "Libra", symbol: "‚ôé", start: 180 },
  { name: "Scorpio", symbol: "‚ôè", start: 210 },
  { name: "Sagittarius", symbol: "‚ôê", start: 240 },
  { name: "Capricorn", symbol: "‚ôë", start: 270 },
  { name: "Aquarius", symbol: "‚ôí", start: 300 },
  { name: "Pisces", symbol: "‚ôì", start: 330 }
];
    const form = document.getElementById('birth-form');
    const resultsDiv = document.getElementById('results');
    const shopBtn = document.getElementById('shopBtn');
    const chartDesc = document.getElementById('chart-description');
    shopBtn.style.display = 'none';

    function themedBlock(title, content) {
      return `<div style="background:rgba(42,8,69,0.85);border-radius:14px;padding:1.2rem 1rem;margin-bottom:1.2rem;box-shadow:0 2px 12px #b23cf0;color:#ffe66f;">
        <h3 style="margin-top:0;color:#ffe66f;font-size:1.3rem;">${title}</h3>
        <div style="color:#fff;">${content}</div>
      </div>`;
    }

    function showLoading() {
      resultsDiv.innerHTML = themedBlock('Calculating Your Chart...', '<span style="font-size:1.2rem;">Please wait while we align the stars ‚ú®</span>');
      shopBtn.style.display = 'none';
    }

    function getPlanetMeaning(planet, sign) {
      const baseMeanings = {
        Aries: 'initiative, courage, and directness',
        Taurus: 'stability, patience, and sensuality',
        Gemini: 'curiosity, adaptability, and wit',
        Cancer: 'sensitivity, nurturing, and intuition',
        Leo: 'creativity, confidence, and generosity',
        Virgo: 'practicality, analysis, and service',
        Libra: 'harmony, diplomacy, and charm',
        Scorpio: 'intensity, transformation, and passion',
        Sagittarius: 'optimism, adventure, and wisdom',
        Capricorn: 'discipline, ambition, and responsibility',
        Aquarius: 'innovation, independence, and humanitarianism',
        Pisces: 'compassion, imagination, and empathy'
      };
      const meanings = {
        Sun: {
          Aries: 'Vitality, leadership, and boldness.', Taurus: 'Stability, patience, and sensuality.', Gemini: 'Curiosity, adaptability, and wit.', Cancer: 'Sensitivity, nurturing, and intuition.', Leo: 'Creativity, confidence, and generosity.', Virgo: 'Practicality, analysis, and service.', Libra: 'Harmony, diplomacy, and charm.', Scorpio: 'Intensity, transformation, and passion.', Sagittarius: 'Optimism, adventure, and wisdom.', Capricorn: 'Discipline, ambition, and responsibility.', Aquarius: 'Innovation, independence, and humanitarianism.', Pisces: 'Compassion, imagination, and empathy.'
        },
        Moon: {
          Aries: 'Emotional drive, spontaneity, and courage.', Taurus: 'Emotional steadiness, comfort, and loyalty.', Gemini: 'Restlessness, curiosity, and sociability.', Cancer: 'Deep feelings, protectiveness, and empathy.', Leo: 'Warmth, pride, and playfulness.', Virgo: 'Nervousness, helpfulness, and discernment.', Libra: 'Need for balance, partnership, and peace.', Scorpio: 'Intensity, secrecy, and transformation.', Sagittarius: 'Optimism, freedom, and exploration.', Capricorn: 'Reserve, caution, and ambition.', Aquarius: 'Detachment, originality, and friendship.', Pisces: 'Sensitivity, intuition, and compassion.'
        },
        Venus: {
          Aries: 'passion and excitement',
          Taurus: 'loyalty and sensual comfort',
          Gemini: 'mental stimulation and variety',
          Cancer: 'emotional security and nurturing',
          Leo: 'romance and admiration',
          Virgo: 'practical support and helpfulness',
          Libra: 'harmony and partnership',
          Scorpio: 'intensity and deep connection',
          Sagittarius: 'freedom and adventure',
          Capricorn: 'commitment and stability',
          Aquarius: 'friendship and uniqueness',
          Pisces: 'compassion and spiritual bonding'
        },
        Mercury: baseMeanings,
        Mars: baseMeanings,
        Jupiter: baseMeanings,
        Saturn: baseMeanings,
        Uranus: baseMeanings,
        Neptune: baseMeanings,
        Pluto: baseMeanings
      };
      return meanings[planet] && meanings[planet][sign] ? meanings[planet][sign] : '';
    }

    function showResults(data, readingType) {
      // Debug: Log degrees and signs for Sun, Moon, Ascendant
      const sunDeg = data.planets?.Sun;
      const moonDeg = data.planets?.Moon;
      const ascDeg = data.ascendant;
      console.log('Sun degree:', sunDeg, 'Sign:', getZodiac(sunDeg)?.name);
      console.log('Moon degree:', moonDeg, 'Sign:', getZodiac(moonDeg)?.name);
      console.log('Ascendant degree:', ascDeg, 'Sign:', getZodiac(ascDeg)?.name);
      const canvas = document.getElementById('birth-chart');
      // Helper: Element & Modality breakdown
      function getElementModalityBreakdown(planets) {
        const elements = { Fire: 0, Earth: 0, Air: 0, Water: 0 };
        const modalities = { Cardinal: 0, Fixed: 0, Mutable: 0 };
        const signInfo = {
          Aries: ['Fire', 'Cardinal'], Taurus: ['Earth', 'Fixed'], Gemini: ['Air', 'Mutable'], Cancer: ['Water', 'Cardinal'],
          Leo: ['Fire', 'Fixed'], Virgo: ['Earth', 'Mutable'], Libra: ['Air', 'Cardinal'], Scorpio: ['Water', 'Fixed'],
          Sagittarius: ['Fire', 'Mutable'], Capricorn: ['Earth', 'Cardinal'], Aquarius: ['Air', 'Fixed'], Pisces: ['Water', 'Mutable']
        };
        Object.entries(planets || {}).forEach(([p, v]) => {
          const zodiac = getZodiac(v).name;
          const [el, mod] = signInfo[zodiac] || [];
          if (el) elements[el]++;
          if (mod) modalities[mod]++;
        });
        return { elements, modalities };
      }

      // Helper: Strengths & Challenges
      function getStrengthsChallenges(data) {
        // Example logic: more planets in Fire = energetic, in Water = sensitive, etc.
        const breakdown = getElementModalityBreakdown(data.planets);
        let strengths = [], challenges = [];
        if (breakdown.elements.Fire > 3) strengths.push('High energy, enthusiasm, and leadership');
        if (breakdown.elements.Water > 3) strengths.push('Deep sensitivity, intuition, and empathy');
        if (breakdown.elements.Earth > 3) strengths.push('Practicality, reliability, and stability');
        if (breakdown.elements.Air > 3) strengths.push('Intellect, communication, and adaptability');
        if (breakdown.elements.Fire < 2) challenges.push('May lack motivation or assertiveness');
        if (breakdown.elements.Water < 2) challenges.push('May struggle with emotional expression');
        if (breakdown.elements.Earth < 2) challenges.push('May feel ungrounded or scattered');
        if (breakdown.elements.Air < 2) challenges.push('May struggle with social connection or ideas');
        return { strengths, challenges };
      }

      // Helper: Career & Relationship Guidance
      function getGuidance(data) {
        // Example: Sun sign for career, Venus/Moon for relationships
        const sunSign = getZodiac(data.planets?.Sun || 0).name;
        const moonSign = getZodiac(data.planets?.Moon || 0).name;
        const venusSign = getZodiac(data.planets?.Venus || 0).name;
        return {
          career: `Your Sun in ${sunSign} suggests you thrive in careers that value ${getPlanetMeaning('Sun', sunSign)}`,
          relationship: `Your Moon in ${moonSign} and Venus in ${venusSign} indicate you seek ${getPlanetMeaning('Moon', moonSign)} and value ${getPlanetMeaning('Venus', venusSign)} in relationships.`
        };
      }

      // Helper: Affirmations
      function getAffirmations(data) {
        const sunSign = getZodiac(data.planets?.Sun || 0).name;
        return [`I embrace my ${sunSign} energy and shine my light authentically.`, `I honor my emotions and nurture my inner self.`, `I am open to growth and new experiences.`];
      }

      // Helper: Astrology Glossary
      const glossary = {
        Sun: 'Core identity, ego, life purpose', Moon: 'Emotions, instincts, inner self', Ascendant: 'Outward personality, first impressions',
        Venus: 'Love, beauty, relationships', Mars: 'Drive, action, passion', Jupiter: 'Expansion, luck, wisdom', Saturn: 'Discipline, structure, responsibility',
        Uranus: 'Innovation, change, rebellion', Neptune: 'Dreams, intuition, spirituality', Pluto: 'Transformation, power, rebirth'
      };

      // Helper: Daily Crystal Suggestion (random)
      function getDailyCrystal() {
        const crystals = [
          { name: 'Amethyst', reason: 'Enhances intuition and spiritual growth.' },
          { name: 'Citrine', reason: 'Boosts confidence, creativity, and abundance.' },
          { name: 'Rose Quartz', reason: 'Promotes love, compassion, and emotional healing.' },
          { name: 'Black Tourmaline', reason: 'Provides protection and grounding.' },
          { name: 'Clear Quartz', reason: 'Amplifies energy and clarity.' }
        ];
        return crystals[Math.floor(Math.random() * crystals.length)];
      }

      // Helper: Transit Forecast (demo)
      function getTransitForecast() {
        return 'Mercury is currently in retrograde. Reflect before making big decisions and double-check communications.';
      }

      // Helper: Save/Share/Download
      function addSaveShareDownload() {
        return `<div style='margin:1.2rem 0;text-align:center;'>
          <button onclick='window.print()' style='background:#b23cf0;color:#ffe66f;padding:0.7rem 1.5rem;border-radius:8px;border:none;font-weight:600;cursor:pointer;'>Print/Save Chart</button>
        </div>`;
      }

      let html = '';
      // Planet symbols and zodiac signs
      const planetSymbols = {
        Sun: '‚òâ', Moon: '‚òΩ', Mercury: '‚òø', Venus: '‚ôÄ', Mars: '‚ôÇ', Jupiter: '‚ôÉ', Saturn: '‚ôÑ', Uranus: '‚ôÖ', Neptune: '‚ôÜ', Pluto: '‚ôá'
      };
     // ...existing code...
      function getZodiac(degree) {
        for (let i = zodiacSigns.length - 1; i >= 0; i--) {
          if (degree >= zodiacSigns[i].start) return zodiacSigns[i];
        }
        return zodiacSigns[0];
      }
      function chartPatternAnalysis(data) {
        // Example: Splash pattern logic
        const positions = Object.values(data.planets || {});
        if (!positions.length) return { pattern: 'Unknown', description: 'Not enough data.', traits: '', advice: '' };
        let spread = positions.reduce((acc, v, i, arr) => {
          if (i === 0) return acc;
          return acc + Math.abs(v - arr[i - 1]);
        }, 0);
        let pattern = 'Splash';
        let description = 'Your planets are distributed across the chart, indicating versatility, adaptability, and a wide range of interests.';
        let traits = 'You are open-minded, curious, and enjoy exploring many different areas of life. You thrive in diverse environments and are comfortable with change.';
        let advice = 'Focus on developing depth in a few areas to balance your broad interests. Embrace your adaptability, but be mindful of scattering your energy.';
        if (spread < 120) {
          pattern = 'Bundle';
          description = 'Your planets are tightly clustered, showing focus, intensity, and specialization.';
          traits = 'You are highly focused, determined, and excel at mastering specific skills. You prefer working within a defined area and can be very productive.';
          advice = 'Allow yourself to explore outside your comfort zone occasionally. Collaboration with others can help broaden your perspective.';
        } else if (spread > 300) {
          pattern = 'Splash';
          description = 'Your planets are distributed across the chart, indicating versatility, adaptability, and a wide range of interests.';
          traits = 'You are open-minded, curious, and enjoy exploring many different areas of life. You thrive in diverse environments and are comfortable with change.';
          advice = 'Focus on developing depth in a few areas to balance your broad interests. Embrace your adaptability, but be mindful of scattering your energy.';
        } else if (spread > 200) {
          pattern = 'Bowl';
          description = 'Your planets are grouped in half the chart, showing self-containment and strong inner drive.';
          traits = 'You are self-reliant, motivated, and have a strong sense of purpose. You often work independently and are driven by inner goals.';
          advice = 'Seek out opportunities for collaboration and connection. Sharing your journey with others can bring new insights and growth.';
        }
        return { pattern, description, traits, advice };
      }
      if (readingType === 'bigThree') {
        // 1. Your Big Three
        html += themedBlock('Your Big Three',
          `<ul style='list-style:none;padding:0;'>
            <li><b>Sun:</b> ${planetSymbols.Sun} ${data.planets?.Sun ? data.planets.Sun.toFixed(2) + '¬∞ ' + getZodiac(data.planets.Sun).symbol + ' ' + getZodiac(data.planets.Sun).name : 'N/A'}<br><span style='color:#ffe66f;font-size:0.95em;'>Represents your core identity, ego, and life purpose. The sign and house show how you shine and express yourself.</span></li>
            <li><b>Moon:</b> ${planetSymbols.Moon} ${data.planets?.Moon ? data.planets.Moon.toFixed(2) + '¬∞ ' + getZodiac(data.planets.Moon).symbol + ' ' + getZodiac(data.planets.Moon).name : 'N/A'}<br><span style='color:#ffe66f;font-size:0.95em;'>Represents your emotions, instincts, and inner self. The sign and house show how you nurture and respond emotionally.</span></li>
            <li><b>Ascendant:</b> ${data.ascendant ? data.ascendant.toFixed(2) + '¬∞ ' + getZodiac(data.ascendant).symbol + ' ' + getZodiac(data.ascendant).name : 'N/A'}<br><span style='color:#ffe66f;font-size:0.95em;'>Represents your outward personality, appearance, and first impressions. The sign and house show how you approach life and new situations.</span></li>
          </ul>`);
        // 2. Element & Modality Breakdown
        const breakdown = getElementModalityBreakdown(data.planets);
        html += themedBlock('Element & Modality Breakdown', `<b>Elements:</b> <span style='color:#ffe66f;'>Fire: ${breakdown.elements.Fire}, Earth: ${breakdown.elements.Earth}, Air: ${breakdown.elements.Air}, Water: ${breakdown.elements.Water}</span><br><b>Modalities:</b> <span style='color:#ffe66f;'>Cardinal: ${breakdown.modalities.Cardinal}, Fixed: ${breakdown.modalities.Fixed}, Mutable: ${breakdown.modalities.Mutable}</span>`);
        // 3. What This Says About You
        html += themedBlock('What This Says About You',
          `${Object.entries(data.planets || {}).map(([p, v]) => {
            const zodiac = getZodiac(v);
            return `<b>${p}:</b> <span style='color:#fff;'>${zodiac.name} (${zodiac.symbol}) ‚Äî </span><span style='color:#ffe66f;'>${getPlanetMeaning(p, zodiac.name)}</span>`;
          }).join('<br>')}<br><br>
          <b>Ascendant:</b> <span style='color:#fff;'>${data.ascendant ? getZodiac(data.ascendant).name : 'N/A'}</span> (${data.ascendant ? getZodiac(data.ascendant).symbol : ''})<br>
          <span style='color:#ffe66f;'><i>Each planet's sign reveals a unique aspect of your personality and life path. Your Sun shows your core self, Moon your emotions, Mercury your mind, Venus your love style, Mars your drive, Jupiter your growth, Saturn your discipline, Uranus your innovation, Neptune your dreams, Pluto your transformation, and the Ascendant your outward persona.</i></span>`);
        // 4. Astrology Glossary
        html += themedBlock('Astrology Glossary', Object.entries(glossary).map(([k,v]) => `<b>${k}:</b> <span style='color:#ffe66f;'>${v}</span>`).join('<br>'));
        // 5. Strengths & Challenges
        const sc = getStrengthsChallenges(data);
        html += themedBlock('Strengths & Challenges', `<b>Strengths:</b> <span style='color:#ffe66f;'>${sc.strengths.join(', ') || 'Balanced energies.'}</span><br><b>Challenges:</b> <span style='color:#ffe66f;'>${sc.challenges.join(', ') || 'No major challenges.'}</span>`);
        // 6. Career & Relationship Guidance
        const guide = getGuidance(data);
        html += themedBlock('Career & Relationship Guidance', `<b>Career:</b> <span style='color:#ffe66f;'>${guide.career}</span><br><b>Relationships:</b> <span style='color:#ffe66f;'>${guide.relationship}</span>`);
        // 7. Affirmations
        html += themedBlock('Affirmations', getAffirmations(data).map(a => `<span style='color:#fff;'>${a}</span>`).join('<br>'));
        // 8. Transit Forecast
        html += themedBlock('Transit Forecast', `<span style='color:#fff;'>${getTransitForecast()}</span>`);
        // 9. Crystal Recommendation (with explanation)
        html += themedBlock('Crystal Recommendation', `
          <span><b style='color:#fff;'>Amethyst</b>: <span style='color:#ffe66f;'>Enhances intuition and spiritual growth.</span></span><br>
          <span><b style='color:#fff;'>Citrine</b>: <span style='color:#ffe66f;'>Boosts confidence, creativity, and abundance.</span></span><br>
          <span><b style='color:#fff;'>Rose Quartz</b>: <span style='color:#ffe66f;'>Promotes love, compassion, and emotional healing.</span></span><br>
          <span style='color:#ffe66f;'><i>These crystals are chosen based on your chart's planetary placements and energies. Each supports your strengths and helps balance your challenges.</i></span>
        `);
        // 10. Daily Crystal Suggestion (with explanation)
        const dailyCrystal = getDailyCrystal();
        html += themedBlock('Daily Crystal Suggestion', `
          <span><b style='color:#fff;'>${dailyCrystal.name}</b>: <span style='color:#ffe66f;'>${dailyCrystal.reason}</span></span><br>
          <span style='color:#ffe66f;'><i>This crystal is selected for today's transits and your personal chart, offering support and guidance for the day.</i></span>
        `);
        // Save/Share/Download
        html += addSaveShareDownload();
      } else {
        // 1. Planetary Insight
        html += themedBlock('Planetary Insight',
          `<ul style='list-style:none;padding:0;'>
            ${Object.entries(data.planets || {}).map(([p, v]) => {
              const zodiac = getZodiac(v);
              return `<li><b>${planetSymbols[p] || p} ${p}:</b> <span style='color:#fff;'>${v ? v.toFixed(2) + '¬∞ ' + zodiac.symbol + ' ' + zodiac.name : 'N/A'}</span><br><span style='color:#ffe66f;font-size:0.95em;'><i>${p} in ${zodiac.name}: ${getPlanetMeaning(p, zodiac.name)}</i></span></li>`;
            }).join('')}
          </ul>`);
        // 2. Houses
        html += themedBlock('Houses',
          `<ul style='list-style:none;padding:0;'>
            ${Object.entries(data.houses || {}).map(([h, v]) => `<li><b>House ${h}:</b> <span style='color:#ffe66f;'>${v.lon ? v.lon.toFixed(2) + '¬∞ ' + getZodiac(v.lon).symbol + ' ' + getZodiac(v.lon).name : 'N/A'}</span></li>`).join('')}
          </ul>`);
        // 3. Chart Pattern
        const patternInfo = chartPatternAnalysis(data);
        html += themedBlock('Chart Pattern', `${patternInfo.pattern} <br><span style='font-size:1rem;color:#fff;'>${patternInfo.description}</span><br><span style='color:#ffe66f;'><i>${patternInfo.traits}</i></span><br><span style='color:#ffe66f;'>Your chart pattern, planetary placements, and house distribution together reveal your strengths, challenges, and life themes. For example, a Splash pattern with planets in many signs suggests adaptability and curiosity, while a Bowl pattern shows focus and self-containment. The houses and aspects add further detail to your personal story.</span><br><br><span style='color:#ffe66f;'><i>${patternInfo.advice}</i></span>`);
        // 4. Element & Modality Breakdown
        const breakdown = getElementModalityBreakdown(data.planets);
        html += themedBlock('Element & Modality Breakdown', `<b>Elements:</b> <span style='color:#ffe66f;'>Fire: ${breakdown.elements.Fire}, Earth: ${breakdown.elements.Earth}, Air: ${breakdown.elements.Air}, Water: ${breakdown.elements.Water}</span><br><b>Modalities:</b> <span style='color:#ffe66f;'>Cardinal: ${breakdown.modalities.Cardinal}, Fixed: ${breakdown.modalities.Fixed}, Mutable: ${breakdown.modalities.Mutable}</span>`);
        // 5. What This Says About You
        html += themedBlock('What This Says About You', `<b>Personality Traits:</b> <span style='color:#ffe66f;'>${patternInfo.traits}</span><br><br><b>Advice:</b> <span style='color:#ffe66f;'>${patternInfo.advice}</span><br><br><span style='color:#ffe66f;'>Your chart pattern, planetary placements, and house distribution together reveal your strengths, challenges, and life themes. For example, a Splash pattern with planets in many signs suggests adaptability and curiosity, while a Bowl pattern shows focus and self-containment. The houses and aspects add further detail to your personal story.</span>`);
        // 6. Astrology Glossary
        html += themedBlock('Astrology Glossary', Object.entries(glossary).map(([k,v]) => `<b>${k}:</b> <span style='color:#ffe66f;'>${v}</span>`).join('<br>'));
        // 7. Strengths & Challenges
        const sc = getStrengthsChallenges(data);
        html += themedBlock('Strengths & Challenges', `<b>Strengths:</b> <span style='color:#ffe66f;'>${sc.strengths.join(', ') || 'Balanced energies.'}</span><br><b>Challenges:</b> <span style='color:#ffe66f;'>${sc.challenges.join(', ') || 'No major challenges.'}</span>`);
        // 8. Career & Relationship Guidance
        const guide = getGuidance(data);
        html += themedBlock('Career & Relationship Guidance', `<b>Career:</b> <span style='color:#ffe66f;'>${guide.career}</span><br><b>Relationships:</b> <span style='color:#ffe66f;'>${guide.relationship}</span>`);
        // 9. Affirmations (description white)
        html += themedBlock('Affirmations', getAffirmations(data).map(a => `<span style='color:#fff;'>${a}</span>`).join('<br>'));
        // 10. Transit Forecast (description white)
        html += themedBlock('Transit Forecast', `<span style='color:#fff;'>${getTransitForecast()}</span>`);
        // 11. Crystal Recommendation
        html += themedBlock('Crystal Recommendation', `
          <span><b style='color:#fff;'>Amethyst</b>: <span style='color:#ffe66f;'>Enhances intuition and spiritual growth.</span></span><br>
          <span><b style='color:#fff;'>Citrine</b>: <span style='color:#ffe66f;'>Boosts confidence, creativity, and abundance.</span></span><br>
          <span><b style='color:#fff;'>Rose Quartz</b>: <span style='color:#ffe66f;'>Promotes love, compassion, and emotional healing.</span></span><br>
          <span style='color:#ffe66f;'><i>These crystals are chosen based on your chart's planetary placements and energies. Each supports your strengths and helps balance your challenges.</i></span>
        `);
        // 12. Daily Crystal
        const dailyCrystal = getDailyCrystal();
        html += themedBlock('Daily Crystal Suggestion', `
          <span><b style='color:#fff;'>${dailyCrystal.name}</b>: <span style='color:#ffe66f;'>${dailyCrystal.reason}</span></span><br>
          <span style='color:#ffe66f;'><i>This crystal is selected for today's transits and your personal chart, offering support and guidance for the day.</i></span>
        `);
        // Save/Share/Download
        html += addSaveShareDownload();
      }
      // ...existing code...
      resultsDiv.innerHTML = html;
      shopBtn.style.display = 'block';

      // Show chart wheel and skymap
      document.querySelector('.chart-container').style.display = 'flex';
      document.querySelector('.sky-container').style.display = 'block';
      document.getElementById('downloadBtn').style.display = 'block';

      // Draw chart wheel
      drawChartWheel(data);
      // Draw skymap
      drawSkyMap(data);
    }

    function drawChartWheel(data) {
      const canvas = document.getElementById('birth-chart');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Draw wheel
      ctx.save();
      ctx.translate(200, 200);
      ctx.beginPath();
      ctx.arc(0, 0, 180, 0, 2 * Math.PI);
      ctx.strokeStyle = '#b23cf0';
      ctx.lineWidth = 4;
      ctx.stroke();
      // Draw houses with labels
      for (let i = 0; i < 12; i++) {
        const angle = (i / 12) * 2 * Math.PI;
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(180 * Math.cos(angle), 180 * Math.sin(angle));
        ctx.strokeStyle = '#ffe66f';
        ctx.lineWidth = 2;
        ctx.stroke();
        // House number label
        ctx.save();
        ctx.translate(170 * Math.cos(angle), 170 * Math.sin(angle));
        ctx.rotate(angle);
        ctx.fillStyle = '#ffe66f';
        ctx.font = 'bold 13px Segoe UI';
        ctx.fillText((i+1).toString(), -7, 5);
        ctx.restore();
      }
      // Draw simple aspects (oppositions)
      if (data.planets) {
        const planetAngles = Object.values(data.planets).map(v => ((v % 360) / 360) * 2 * Math.PI);
        for (let i = 0; i < planetAngles.length; i++) {
          for (let j = i+1; j < planetAngles.length; j++) {
            const diff = Math.abs(planetAngles[i] - planetAngles[j]);
            if (Math.abs(diff - Math.PI) < 0.1) { // opposition aspect
              ctx.beginPath();
              ctx.moveTo(160 * Math.cos(planetAngles[i]), 160 * Math.sin(planetAngles[i]));
              ctx.lineTo(160 * Math.cos(planetAngles[j]), 160 * Math.sin(planetAngles[j]));
              ctx.strokeStyle = '#b23cf0';
              ctx.lineWidth = 1.5;
              ctx.setLineDash([6, 4]);
              ctx.stroke();
              ctx.setLineDash([]);
            }
          }
        }
      }

      // Draw zodiac signs around the wheel
      const zodiacSigns = [
        { name: 'Aries', symbol: '‚ôà', start: 0 },
        { name: 'Taurus', symbol: '‚ôâ', start: 30 },
        { name: 'Gemini', symbol: '‚ôä', start: 60 },
        { name: 'Cancer', symbol: '‚ôã', start: 90 },
        { name: 'Leo', symbol: '‚ôå', start: 120 },
        { name: 'Virgo', symbol: '‚ôç', start: 150 },
        { name: 'Libra', symbol: '‚ôé', start: 180 },
        { name: 'Scorpio', symbol: '‚ôè', start: 210 },
        { name: 'Sagittarius', symbol: '‚ôê', start: 240 },
        { name: 'Capricorn', symbol: '‚ôë', start: 270 },
        { name: 'Aquarius', symbol: '‚ôí', start: 300 },
        { name: 'Pisces', symbol: '‚ôì', start: 330 }
      ];
      zodiacSigns.forEach((sign, i) => {
        const angle = ((sign.start + 15) / 360) * 2 * Math.PI;
        const x = 180 * Math.cos(angle);
        const y = 180 * Math.sin(angle);
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(angle);
        ctx.font = 'bold 20px Segoe UI';
        ctx.fillStyle = '#ffe66f';
        ctx.textAlign = 'center';
        ctx.fillText(sign.symbol, 0, 0);
        ctx.font = '12px Segoe UI';
        ctx.fillStyle = '#fff';
        ctx.fillText(sign.name, 0, 18);
        ctx.restore();
      });
    function getPlanetMeaning(planet, sign) {
      const meanings = {
        Sun: {
          Aries: 'Vitality, leadership, and boldness.', Taurus: 'Stability, patience, and sensuality.', Gemini: 'Curiosity, adaptability, and wit.', Cancer: 'Sensitivity, nurturing, and intuition.', Leo: 'Creativity, confidence, and generosity.', Virgo: 'Practicality, analysis, and service.', Libra: 'Harmony, diplomacy, and charm.', Scorpio: 'Intensity, transformation, and passion.', Sagittarius: 'Optimism, adventure, and wisdom.', Capricorn: 'Discipline, ambition, and responsibility.', Aquarius: 'Innovation, independence, and humanitarianism.', Pisces: 'Compassion, imagination, and empathy.'
        },
        Moon: {
          Aries: 'Emotional drive, spontaneity, and courage.', Taurus: 'Emotional steadiness, comfort, and loyalty.', Gemini: 'Restlessness, curiosity, and sociability.', Cancer: 'Deep feelings, protectiveness, and empathy.', Leo: 'Warmth, pride, and playfulness.', Virgo: 'Nervousness, helpfulness, and discernment.', Libra: 'Need for balance, partnership, and peace.', Scorpio: 'Intensity, secrecy, and transformation.', Sagittarius: 'Optimism, freedom, and exploration.', Capricorn: 'Reserve, caution, and ambition.', Aquarius: 'Detachment, originality, and friendship.', Pisces: 'Sensitivity, intuition, and compassion.'
        },
        Venus: {
          Aries: 'passion and excitement',
          Taurus: 'loyalty and sensual comfort',
          Gemini: 'mental stimulation and variety',
          Cancer: 'emotional security and nurturing',
          Leo: 'romance and admiration',
          Virgo: 'practical support and helpfulness',
          Libra: 'harmony and partnership',
          Scorpio: 'intensity and deep connection',
          Sagittarius: 'freedom and adventure',
          Capricorn: 'commitment and stability',
          Aquarius: 'friendship and uniqueness',
          Pisces: 'compassion and spiritual bonding'
        },
        Mercury: {}, Mars: {}, Jupiter: {}, Saturn: {}, Uranus: {}, Neptune: {}, Pluto: {}
      };
      return meanings[planet] && meanings[planet][sign] ? meanings[planet][sign] : '';
    }
      // Draw planets
      if (data.planets) {
        const planetSymbols = {
          Sun: '‚òâ', Moon: '‚òΩ', Mercury: '‚òø', Venus: '‚ôÄ', Mars: '‚ôÇ', Jupiter: '‚ôÉ', Saturn: '‚ôÑ', Uranus: '‚ôÖ', Neptune: '‚ôÜ', Pluto: '‚ôá'
        };
        Object.entries(data.planets).forEach(([p, v], idx) => {
          const angle = ((v % 360) / 360) * 2 * Math.PI;
          ctx.beginPath();
          ctx.arc(160 * Math.cos(angle), 160 * Math.sin(angle), 10, 0, 2 * Math.PI);
          ctx.fillStyle = '#b23cf0';
          ctx.fill();
          ctx.strokeStyle = '#fff';
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.fillStyle = '#ffe66f';
          ctx.font = 'bold 18px Segoe UI';
          ctx.fillText(planetSymbols[p] || p, 160 * Math.cos(angle) - 8, 160 * Math.sin(angle) + 7);
        });
      }
      ctx.restore();
    }

    function drawSkyMap(data) {
      const canvas = document.getElementById('skyCanvas');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Draw sky gradient background
      const grad = ctx.createLinearGradient(0, 0, 400, 200);
      grad.addColorStop(0, '#2a0845');
      grad.addColorStop(1, '#b23cf0');
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, 400, 200);
      // Draw realistic stars
      for (let i = 0; i < 80; i++) {
        const x = Math.random() * 400;
        const y = Math.random() * 200;
        const r = Math.random() * 1.5 + 0.5;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, 2 * Math.PI);
        ctx.fillStyle = 'white';
        ctx.globalAlpha = Math.random() * 0.7 + 0.3;
        ctx.fill();
        ctx.globalAlpha = 1;
      }

      // Draw planet positions with symbols
      if (data.planets) {
        const planetSymbols = {
          Sun: '‚òâ', Moon: '‚òΩ', Mercury: '‚òø', Venus: '‚ôÄ', Mars: '‚ôÇ', Jupiter: '‚ôÉ', Saturn: '‚ôÑ', Uranus: '‚ôÖ', Neptune: '‚ôÜ', Pluto: '‚ôá'
        };
        Object.entries(data.planets).forEach(([p, v], idx) => {
          const angle = ((v % 360) / 360) * 2 * Math.PI;
          const x = 200 + 160 * Math.cos(angle);
          const y = 200 + 160 * Math.sin(angle);
          ctx.beginPath();
          ctx.arc(x, y, 12, 0, 2 * Math.PI);
          ctx.fillStyle = '#ffe66f';
          ctx.fill();
          ctx.strokeStyle = '#fff';
          ctx.lineWidth = 2;
          ctx.stroke();
          ctx.fillStyle = '#2a0845';
          ctx.font = 'bold 18px Segoe UI';
          ctx.fillText(planetSymbols[p] || p, x - 9, y + 7);
        });
      }
    }
    document.addEventListener('DOMContentLoaded', function() {
      // Download button logic
      document.getElementById('downloadBtn').onclick = function() {
        const canvas = document.getElementById('skyCanvas');
        const link = document.createElement('a');
        link.download = 'skymap.png';
        link.href = canvas.toDataURL();
        link.click();
      };

      const form = document.getElementById('birth-form');
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        showLoading();
        const birthdate = document.getElementById('birthdate').value;
        const birthtime = document.getElementById('birthtime').value;
        const location = document.getElementById('location').value;
        const readingType = document.querySelector('input[name="readingType"]:checked').value;

        // For demo, use dummy lat/lng. Replace with geocoding if needed.
        let lat = 40.7128, lng = -74.0060;
        // Optionally, add geocoding here for real location
        if (!birthdate || !birthtime || !location) {
          resultsDiv.innerHTML = themedBlock('Error', 'Please fill out all fields.');
          return;
        }
        const [year, month, day] = birthdate.split('-').map(Number);
        const [hour, minute] = birthtime.split(':').map(Number);
        console.log('Submitting chart request:', { year, month, day, hour, minute, lat, lng });
        try {
        const res = await fetch('/api/chart', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ year, month, day, hour, minute, lat, lng })
          });
          console.log('Fetch response:', res);
          const data = await res.json();
          console.log('Chart data received:', data);
          if (data.error) {
            resultsDiv.innerHTML = themedBlock('Error', data.error);
            shopBtn.style.display = 'none';
          } else {
            showResults(data, readingType);
          }
        } catch (err) {
          console.error('Fetch error:', err);
          resultsDiv.innerHTML = themedBlock('Error', 'Failed to fetch chart data.');
          shopBtn.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>
